<!-- $Id$ -->
<html>
<head>
<title>Ptolemy NT Bugs</title>
</head>
<body bgcolor=#faf0e6>
<H1>Ptolemy NT Bugs</H1>

<h2>Compilation bugs</h2>
<MENU>

<li> The Microsoft Visual C++ port (<CODE>PTARCH == nt4.vc</CODE>)
is unlikely to build and has not been tested.

<li> Compiling with Cygwin32 is slow.  This is because Cygwin32
adds a layer to file access and other operations.


<li> <CODE>make</CODE> failed with
<pre>
c:/tycho0.3.devel/mk/tycommon.mk:276: *** target pattern contains no `%'.
</pre>
<p>The problem here was that <CODE>ROOT</CODE> was set to
<CODE>c:/tycho0.3devel</CODE>.  The colon was being interpreted by
<CODE>make</CODE>, so setting <CODE>ROOT</CODE> to <CODE>/tycho0.3devel</CODE>
fixed the problem.
 <p>

<li> <CODE>make</CODE> failed with:
<pre>
'\\carson\cxh\pt\obj.nt4\pigiRpc' is an invalid current directory
path.  UNC paths are not supported.  Defaulting to Windows directory.
The handle could not be duplicated during a pipe operation.
</pre>
<p> The fix is to run <CODE>make --unix</CODE>, or do
<pre>
MAKE_MODE=unix
export MAKE_MODE
</pre>

<li> Some of the tests in
<a href="../../src/octtools/Packages/oct"><CODE>$PTOLEMY/src/octtools/Packages/oct</CODE></a> fail.


<li> Compiling <CODE>octtools/tkoct/top</CODE> fails.
The top library is use only by the <CODE>oct2ptcl</CODE> binary, which
is used to convert Oct facets to ptcl scripts.  If you don't need
<CODE>oct2ptcl</CODE>, then you can ignore this error and move on.
(Reported by
Sascha Schwarz <CODE>&lt;saschas@natasha.auslabs.lucent.com&gt;</CODE>).

<li> <CODE>octtools/Xpackages/iv</CODE> fails to compile
<pre>
../../../../src/octtools/Xpackages/iv/ivGetLine.c: In function `ivTextInit':
../../../../src/octtools/Xpackages/iv/ivGetLine.c:98: storage size of `tty'
isn't known
../../../../src/octtools/Xpackages/iv/ivGetLine.c:100: warning: implicit
declaration of function `ioctl'
../../../../src/octtools/Xpackages/iv/ivGetLine.c:100: `TIOCGETC' undeclared
(first use this function)
../../../../src/octtools/Xpackages/iv/ivGetLine.c:100: (Each undeclared
identifier is reported only once
../../../../src/octtools/Xpackages/iv/ivGetLine.c:100: for each function it
appears in.)
</pre>
There are also problems compiling <CODE>timer.c</CODE>

 <p>The <CODE>iv</CODE> package is used to change values of variables
interactively.  I believe that these errors can be ignored, <CODE>iv</CODE>
is not used in <CODE>vem</CODE> or <CODE>pigiRpc</CODE>
(Reported by
Sascha Schwarz <CODE>&lt;saschas@natasha.auslabs.lucent.com&gt;</CODE>).


<li> Problems compiling <CODE>octtools/attache/io.c</CODE>:
<pre>
../../../src/octtools/attache/io.c:39: curses.h: No such file or directory
</pre>
<CODE>attache</CODE> is used to edit Octtools facets by hand.
Most users never need this functionality, so you can probably skip
this error and move on.  <CODE>curses.h</CODE> is the include
file for the curses system, which is a cursor based ascii windowing
package.  To fix this bug, it would be necessary to find
a Cygwin32 curses library and .h file.

(Reported by
Sascha Schwarz <CODE>&lt;saschas@natasha.auslabs.lucent.com&gt;</CODE>).


<li> Problems compiling <CODE>src/tysh/SigHandle.cc</CODE>:
<pre>
../../src/tysh/SigHandle.cc: In function `int setHandlers(void (*)(int))':
../../src/tysh/SigHandle.cc:109: `SIGIOT' undeclared (first use this
function)
</pre>
The <CODE>tysh</CODE> binary is used when <CODE>tycho -pigi</CODE>
is started up.  In the short term, this error can be ignored.

The code in <CODE>SigHandle.cc</CODE>, is used to catch signals so
that we can attempt to save files etc.  This code never really worked
well, and is basically dead code.

 <p>The quick and dirty thing to do would be to just ifdef out those lines.

 <p>I think we could use <CODE>SIGABRT</CODE> instead of
<CODE>SIGIOT</CODE>.  Under Solaris, and egcs-1.0.2,
<CODE>SIGIOT</CODE> and <CODE>SIGABRT</CODE> are both defined as the
number 6.
 <p>Below is a sample code fragment that is unlikely to break other ports.
<pre>
    // Under Cygwin32, SIGIOT is not defined
#ifdef SIGIOT
    if (ptSignal(SIGIOT, sigHandler) != 0) {
        return 5;
    }
#else
    if (ptSignal(SIGABRT, sigHandler) != 0) {
        return 5;
    }
#endif

</pre>

 <p>(Reported by
Sascha Schwarz <CODE>&lt;saschas@natasha.auslabs.lucent.com&gt;</CODE>).


<li> Tydoc fails:
<pre>
"set retval [::tycho::HTMLDocSys::generateHTML $verbose $debug
$generateIndex $title  [lrange $args $switchCount end]]..."
can't read "retval": no such variable
    while executing
"if {$retval != ""} {
	puts "tydoc returned $retval\n$errorInfo"
	exit 3
    }"
    (procedure "tydoc" line 43)
    invoked from within
"tydoc -d testDefs.tcl"
    ("eval" body line 1)
    invoked from within
"eval tydoc $argv"
    (file "../../util/tydoc/bin/tydoc" line 72)
make[3]: *** [itcldocs] Error 1

</pre>
The fix is to edit <CODE>$PTOLEMY/tycho/util/tydoc/tydoc.tcl</CODE>
and add <CODE>set retval ""</CODE> before the catch:
<pre>
    set retval ""
    if [catch {set retval [::tycho::HTMLDocSys::generateHTML $verbose $debug \
	    $generateIndex $title \
	    [lrange $args $switchCount end]]} err ] {
	puts "tydoc: $err\n$errorInfo"
	
    }
    if {$retval != ""} {
	puts "tydoc returned $retval\n$errorInfo"
	exit 3
    }
}

</pre>
(Reported by
Sascha Schwarz <CODE>&lt;saschas@natasha.auslabs.lucent.com&gt;</CODE>).

</MENU>


<h2>Problems Starting Ptolemy</h2>
<menu>

<li> <CODE>$PTOLEMY/bin/pigi</CODE> prints warning messages about
not being able to find <CODE>xrdb</CODE>.  This is because
<CODE>/bin/sh.exe</CODE> does not have a working <CODE>type</CODE>
command.  One workaround would be to copy <CODE>bash.exe</CODE>
to <CODE>/bin/sh.exe</CODE>, though this will result in slower compiles.

<li> Starting up <CODE>pigi</CODE> results in messages like:
<pre>
Error: Unable to load ptk startup file: : 
  can't find package tycho.kernel.basic: can't find
  package tycho.kernel.basic
    while executing
"package require tycho.kernel.basic"
    (file "C:\tycho0.3devel/kernel/Tycho.tcl" line 255)
    invoked from within
"source $path/kernel/Tycho.tcl"
</pre>
This message can occur if you have a standalone installation of 
Tycho installed.  The workaround is to unset TYCHO before starting pigi:
<pre>
unset TYCHO
pigi
</pre>

<li> If you see the following message, then you may need to 
upgrade to Cygwinb19.1.
<pre>
RPC Error: can not fdopen for write in application
RPC Error: cannot connect to the server
</pre>


<li> Locally we use Hummingbird's Exceed X server.  Sascha Schwarz
<CODE>&lt;saschas@natasha.auslabs.lucent.com&gt;</CODE>, reported font
problems with the MicroImages X server that were solved by using
Exceed.  If you have font problems, you might try the following:

	<ol>
	<li> Be sure that another X client starts up before starting
	<CODE>pigi</CODE>.  The <CODE>pigi</CODE> script attempts
	to start <CODE>xclock</CODE> by hand if <CODE>xrdb -query</CODE>
	return no resources.  Be sure that <CODE>pigi</CODE>
	successfully starts <CODE>xclock</CODE>, or start it
	by hand before running <CODE>pigi</CODE>

	<li> Add the following line to your <CODE>.Xdefaults</CODE>
	file:
	<pre>
	Vem.label.fonts: 9x15
	</pre>
	then do <CODE>xrdb -merge ~/.Xdefaults</CODE>
	</ol>


</menu>

<h2>Problems Running Ptolemy</h2>
<MENU>


<li> If you have problems with <CODE>pxgraph</CODE>, see
the <a href="ptntinstall.html#pxgraph">Ptolemy NT Installation page</a>,
and <a href="../../../src/pxgraph/README.txt"><CODE>$PTOLEMY/src/pxgraph/README.txt</CODE></a>

<li> The SDF Butterfly demo gives a bogus graph
The problem here is that the temporary plot data files were not
being opened in binary mode, so they were being truncated.
 <p>The file to change is <CODE>src/kernel/Display.cc</CODE>.
The change to make is to change:
<pre>
 	    if ((strm[i] = fopen(tmpFileNames[i], "w")) == NULL) {
</pre>
To
<pre>
 	    if ((strm[i] = fopen(tmpFileNames[i], "wb")) == NULL) {
</pre>

<li> The Matlab and Mathematica stars do not work.

<li> The SDF Gaussian demo fails with:
<pre>
Error: no interpreter to evaluate 'expr 1024/8'
</pre>
This message comes from <CODE>kernel/InvokeInterp.cc</CODE>:
<pre>
// send a string to an external interpreter for evaluation
const char*
InvokeInterp :: interpreter(const char* expression) {
    Error::error("no interpreter to evaluate '", expression, "'.");
    return NULL;
}
</pre>
The problem here is that there are multiple
definitions of this method in the kernel, pigilib and ptcl.

 <p>Wolfgang Reimer created a patch that solves this problem, see:
<a href="http://ptolemy.eecs.berkeley.edu/pt0.7.1/ptolemy0.7.1/html/reimer0898/pt0.7.1p1.ptclInvokeInterp.patch.gz"><CODE>http://ptolemy.eecs.berkeley.edu/pt0.7.1/ptolemy0.7.1/html/reimer0898/pt0.7.1p1.ptclInvokeInterp.patch.gz</CODE></a>


</MENU>

<HR>
<A HREF="index.html">Up to the Ptolemy under NT page</A> -
<A HREF="ptnthints.html">Back to Ptolemy NT Hints</A> -
<A HREF="ptntinstall.html">Forward to Ptolemy NT Installation</A>
<HR>
Copyright &#169 1997-%Q%, The Regents of the University of California.
All rights reserved.
<br>
Last updated: $Date$,
comments to: <author>cxh@eecs.berkeley.edu</author>
