\c Version $Id$
\node CGC Domain
\chapter{CGC Domain}

\Author{Joseph Buck \\
Soonhoi Ha \\
Edward A. Lee \\
Thomas M. Parks}
\date{$Date$}

The \dfn{CGC domain} of Ptolemy generates code
for the \code{C} programming language.
\cindex{code generation in C}
\cindex{C code generation}
\cindex{CGC domain}
This domain supports both synchronous dataflow
(\pxref{SDF Domain})
\cindex{synchronous dataflow}
\cindex{dataflow, synchronous}
and Boolean-controlled dataflow
(\pxref{BDF Domain})
\cindex{Boolean-controlled dataflow}
\cindex{dataflow, Boolean-controlled}
models of computation.  The model 
associated with a particular program graph is determined by
which target is selected.  The \code{bdf-CGC} target supports the BDF
model, while all other targets in the CGC domain support the more
limited SDF model.  Code can be generated for both single-processor
and multi-processor computers.  The targets that support
single processors include \code{default-CGC}, \code{TclTk_Target}, and
\code{bdf-CGC}.  The multi-processor target is \code{unixMulti_C}.

\node CGC Targets
\section{CGC Targets}

The targets of the CGC domain
generate \code{C} code from dataflow program graphs.
Code generation is controlled by the \var{host}, \var{directory}, and
\var{file} parameters as described in \nxref{CG Single-Processor Targets}.
\vindex{host parameter}
\vindex{directory parameter}
\vindex{file parameter}
The command used to compile the code is determined by the
\var{compileCommand}, \var{compileOptions}, and \var{linkOptions}
\vindex{compileCommand parameter}
\vindex{compileOptions parameter}
\vindex{linkOptions parameter}
parameters.  Compilation and execution are controlled by the
\var{display?}, \var{compile?}, and \var{run?}
\vindex{display? parameter}
\vindex{compile? parameter}
\vindex{run? parameter}
parameters, also described in \nxref{CG Single-Processor Targets}.
The other parameters common to all CGC targets are listed below.  Not
all of these parameters are made available to the user by every
target, and some targets define additional parameters.

\begin{statelist}{parameter}
\state{INT}{staticBuffering}{TRUE}
If \samp{TRUE}, then attempt to static, compile-time addressing of data
buffers between stars.  Otherwise, use dynamic, run-time addressing.

\state{STRING}{funcName}{main}
The name of the main function.  The default value of \samp{main} is suitable
for generating stand-alone programs.  Choose another name if you wish to use
the generated code as a procedure that is called from your own main program.

\state{STRING}{compileCommand}{cc}
Command name of the compiler.

\state{STRING}{compileOptions}{}
Options passed to the compiler.

\state{STRING}{linkOptions}{-lm}
Options passed to the linker.

\state{STRINGARRAY}{resources}{STDIO}
List of abstract resources that the host computer has.
\end{statelist}

\node CGC Single-Processor Targets
\subsection{Single-Processor Targets}

\begin{table}
\centering
\c Align the text so that it will look right in the info file.
\begin{tabular}{lll}
    \var{compile?}      &\var{file}       &\var{Looping Level}\\
    \var{compileCommand}&\var{funcName}   &\var{resources}\\
    \var{compileOptions}&\var{host}       &\var{run?}\\
    \var{directory}     &\var{linkOptions}&\var{staticBuffering}\\
    \var{display?}      &                 &\\
\end{tabular}
\caption{Parameters for the \protect\code{default-CGC} target.}
\label{default-CGC-parameters}
\end{table}

The \code{default-CGC} target
\tindex{default-CGC target}
generates \code{C} code for a single
processor from a SDF program graph.  The parameters available to the
user are shown in table \ref{default-CGC-parameters}.  See \nxref{CG
Single-Processor Targets}, and \nxref{CGC Targets} for detailed
descriptions of these parameters.

The \code{TclTk_Target} target,
\tindex{TclTk_Target target}
which is derived from the \code{default-CGC} target,
must be used when Tcl/Tk stars are present in
the program graph.  The parameters differ from those of the
\code{default-CGC} target only in their default values.

\begin{statelist}{parameter}

\state{INT}{loopingLevel}{1}

\state{STRING}{funcName}{go}

\state{STRING}{compileOptions}{-I$PTOLEMY/tcl/tk/src \\
    -I$PTOLEMY/tcl/tcl/src \\
    -I$PTOLEMY/src/domains/cgc/tcltk/lib}

\state{STRING}{linkOptions}{-L$PTOLEMY/tcl/tk/lib/$ARCH.opt \\
    -L$PTOLEMY/tcl/tcl/lib/$ARCH.opt \\
    -L$PTOLEMY/lib.$ARCH \\
    -L$PTOLEMY/tcl/tk/lib/$ARCH.opt \\
    -L/usr/X11/lib -ltk -ltcl -lptk -lXpm -lX11 -lm}

\end{statelist}


The \code{bdf-CGC} target
\tindex{bdf-CGC target}
supports the Boolean-controlled dataflow (BDF) model of
computation.  It must be used when BDF stars are present in the program
graph.  It can also be used with program graphs that contain only
synchronous dataflow (SDF) stars.
The \code{bdf-CGC} target has the same parameters as the
\code{default-CGC} target with the exception that
the \var{Looping Level} parameter is absent.  This is because a
loop-generating algorithm is always used for scheduling.
\xref{BDF Domain}, for details on the scheduling algorithm.

\node CGC Multi-Processor Targets
\subsection{Multi-Processor Targets}

\begin{table}
\centering
\c Align the text so it will look right in the info file.
\begin{tabular}{lll}
    \var{adjustSchedule}&\var{ignoreIPC}        &\var{overlapComm}\\
    \var{amortizedComm} &\var{inheritProcessors}&\var{portNumber}\\
    \var{childType}     &\var{logFile}          &\var{relTimeScales}\\
    \var{compile?}      &\var{machineNames}     &\var{resources}\\
    \var{directory}     &\var{manualAssignment} &\var{run?}\\
    \var{display?}      &\var{nameSuffix}       &\var{sendTime}\\
    \var{file}          &\var{nprocs}           &\var{userCluster}\\
    \var{ganttChart}    &\var{oneStarOneProc}   &\\
\end{tabular}
\caption{Parameters for the \protect\code{unixMulti_C} target.}
\label{unixMultiC-parameters}
\end{table}

The supported multi-processor target in the CGC domain is \code{unixMulti_C}.
It generates code for multiple networked workstations, using a shared bus
configuration for scheduling purposes.  In addition to the target
parameters described in
\nxref{CGC Targets}, and \nxref{CG Multi-Processor Targets},
this target defines the user parameters listed below.
Table \ref{unixMultiC-parameters} gives the complete list of parameters for
the \code{unixMulti_C} target.

\begin{statelist}{parameter}
\state{INT}{portNumber}{7654}
The starting port number used by send/receive stars.  The port number
will be incremented for each send/receive pair.  It is the
responsibility of the user to ensure that the port number does not
conflict with any that may already be in use.

\state{STRING}{machineNames}{herschel}
The names of the networked workstations which form the
multi-processor.  The names should be separated by a comma (\samp{,}).

\state{STRING}{nameSuffix}{}
The domain suffix for the workstations named in \var{machineNames}.  If left
blank, which is the default, then the workstations are assumed to be part of
the local domain.  Otherwise, specify the proper domain name, including
a leading period, such as \samp{.berkeley.edu}.
\end{statelist}

\node CGC Star Overview
\section{An Overview of CGC Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/main.pal.ps}
\caption{Top-level palette of stars in the CGC domain.}
\end{figure}

\node CGC Source Stars
\subsection{Source Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/sources.pal.ps}
\caption{Source stars in the CGC domain.}
\label{figure CGC source stars}
\end{figure}

Source stars have no inputs and only produce data on their outputs.
Figure \ref{figure CGC source stars} shows the palette of CGC source
stars.  The following stars are equivalent to the SDF stars of the same
name:
\code{Const},
\code{IIDUniform},
\code{Impulse},
\code{Ramp},
\code{singen},
\code{TkSlider},
\code{WaveForm}.
Refer to \nxref{SDF Domain} for short descriptions of these stars.
Stars that are unique to the CGC domain are described briefly below.
Refer to the Almagest Star Atlas for a more detailed description.

\begin{blocklist}{(CGC block)}

\block{PCMread}
Read \( \mu \)-law PCM from a file and convert to linear floating point.
The file can be the audio port \file{/dev/audio},
if supported by the workstation.

\block{TkEntry}
Output a constant signal with value determined by a Tk entry box.

\block{TkImpulse}
Output an impulse when a button is pushed.

\end{blocklist}

\node CGC Sink Stars
\subsection{Sink Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/sinks.pal.ps}
\caption{Sink stars in the CGC domain.}
\label{figure CGC sink stars}
\end{figure}

Sink stars have no outputs and only consume data on their inputs.
Figure \ref{figure CGC sink stars} shows the palette of CGC sink stars.
The following stars are equivalent to the SDF stars of the same name:
\code{BlackHole},
\code{Printer},
\code{Xgraph},
\code{XMgraph},
\code{Xscope},
\code{XYgraph}.
Refer to \nxref{SDF Domain} for short descriptions of these stars.
Stars that are unique to the CGC domain are described briefly below.
Refer to the Almagest Star Atlas for a more detailed description.

\begin{blocklist}{(CGC block)}
\block{PCMwrite}
Convert input to \( \mu \) -law PCM and write it to a file.
The file can be the audio port \file{/dev/audio},
if supported by the workstation.

\block{SunSound}
Convert input to \( \mu \) -law PCM and write to the Sun audio port
\file{/dev/audio}.
The input is expected to be in the range from -1.0 to 1.0.
If the \var{aheadLimit} parameter is non-negative, then it specifies
\vindex{aheadLimit parameter}
the maximum number of samples that the program will be allowed to compute
ahead of real time.

\end{blocklist}

\node CGC Arithmetic Stars
\subsection{Arithmetic Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/arithmetic.pal.ps}
\caption{Arithmetic stars in the CGC domain.}
\label{figure CGC aritmetic stars}
\end{figure}

Arithmetic stars perform simple functions.
Figure \ref{figure CGC aritmetic stars} shows the palette of CGC
aritmetic stars.
The following stars are equivalent to the SDF stars
of the same name:
\code{Add},
\code{Gain},
\code{Integrator},
\code{Mpy},
\code{Sub}.
Refer to \nxref{SDF Domain} for short descriptions of these stars.
Stars that are unique to the CGC domain are described briefly below.
Refer to the Almagest Star Atlas for a more detailed description.

\begin{blocklist}{(CGC block)}

\block{Expr}
General expression evaluation.  This star evaluates the expression
given by the \var{expr} parameter and writes the result on
\var{output}.  The default expression, which is \samp{$ref(in#1)}
simply copies the first input to the output.

\end{blocklist}

\node CGC Nonlinear Stars
\subsection{Nonlinear Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/nonlinear.pal.ps}
\caption{Nonlinear stars in the CGC domain.}
\end{figure}

The following stars are equivalent to the SDF stars
of the same name:
\code{conj},
\code{Cos},
\code{Exp},
\code{expjx},
\code{Log},
\code{powerEst},
\code{Quant},
\code{Reciprocal},
\code{Sin},
\code{Sqrt},
\code{Table}.
Refer to \nxref{SDF Domain} for short descriptions of these stars.
Stars that are unique to the CGC domain are described briefly below.
Refer to the Almagest Star Atlas for a more detailed description.

\begin{blocklist}{(CGC block)}

\block{Thresh}
Compares \var{input} values to \var{threshold}.  The \var{output} is
\samp{0} if \var{input} \( \leq \) \var{threshold}, otherwise it is
\samp{1}.

\end{blocklist}

\node CGC Control Stars
\subsection{Control Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/control.pal.ps}
\caption{Control stars in the CGC domain.}
\end{figure}

Fork
DownSample
UpSample
Sleep
Spread
Collect

\node CGC Conversion Stars
\subsection{Conversion Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/conversion.pal.ps}
\caption{Type-conversion stars in the CGC domain.}
\end{figure}

CxToRect
RectToCx
RectToPolar
PolarToRect

\node CGC Signal Processing Stars
\subsection{Signal Processing Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/dsp.pal.ps}
\caption{Signal processing stars in the CGC domain.}
\end{figure}

FIR
LMS
LMSTkPlot
FFTCx
DB

\begin{ignore}

\node CGC Dynamic Dataflow Stars
\subsection{Dynamic Dataflow Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/nonsdf.pal.ps}
\caption{Dynamic dataflow stars in the CGC domain.}
\end{figure}

\end{ignore}

\node CGC Boolean-Controlled Dataflow Stars
\subsection{Boolean-Controlled Dataflow Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/icons/bdf.pal.ps}
\caption{Boolean-controlled dataflow stars in the CGC domain.}
\end{figure}

Select
Switch

\node CGC Tcl/Tk Stars
\subsection{Tcl/Tk Stars}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/tcltk/icons/tcltk.pal.ps}
\caption{Tcl/Tk stars in the CGC domain.}
\end{figure}

Many of the stars in this palette also appear in other palettes.  The
two that are unique to this palette are described briefly below.  Refer
to the Almagest Star Atlas for a more detailed description.

\begin{blocklist}{(CGC block)}
\block{TclScript}
\block{TkSunSound}
\end{blocklist}

\node CGC Demo Overview
\section{An Overview of CGC Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/init.pal.ps}
\caption{Top-level palette of demos in the CGC domain.}
\end{figure}

\node CGC Basic Demos
\subsection{Basic Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/basic.pal.ps}
\caption{Basic CGC demos.}
\end{figure}

\node CGC Multirate Demos
\subsection{Multirate Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/multirate.pal.ps}
\caption{Multirate CGC demos.}
\end{figure}

\node CGC Signal Processing Demos
\subsection{Signal Processing Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/dsp.pal.ps}
\caption{Signal processing demos in the CGC domain.}
\end{figure}

\node CGC Sound-Making Demos
\subsection{Sound-Making Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/sound.pal.ps}
\caption{Sound-making demos in the CGC domain.}
\end{figure}

\node CGC Dynamic Dataflow Demos
\subsection{Dynamic Dataflow Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/cgddf.pal.ps}
\caption{Dynamic dataflow demos in the CGC domain.}
\end{figure}

\node CGC Tcl/Tk Demos
\subsection{Tcl/Tk Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/tcltk/demo/init.pal.ps}
\caption{Tcl/Tk demos in the CGC domain.}
\end{figure}

\node CGC Boolean-Controlled Dataflow Demos
\subsection{Boolean-Controlled Dataflow Demos}

\begin{figure}
\centering
\ \psfig{figure=/users/ptdesign/src/domains/cgc/demo/bdf.pal.ps}
\caption{Boolean-controlled dataflow demos in the CGC domain.}
\end{figure}
