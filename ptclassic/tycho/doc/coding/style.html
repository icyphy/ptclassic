<!$Id$	%Q%>
<html>
<head>
<title>Programming Style for Tycho</title>
</head>
<body bgcolor="#faf0e6">
<h1>Programming Style for Tycho</h1>
<p>
The following programming style will be followed in the Tycho project.
Please submit comments or suggestions to eal@eecs.berkeley.edu.
<ol>
<li><a href="#indentation">Indentation</a>
<li><a href="#comments">Comments</a>
<li><a href="#names">Names</a>
<li><a href="#global">Global</a>
<li><a href="#documentation">Documentation</a>
<li><a href="#copyright">Copyright and acknowledgements</a>
<li><a href="#proofread">Proofread</a>
</ol>

<h2><a name="indentation">Indentation</a></h2>

Tabs are 8 characters.  Do not override this in your text editor.
Nested statements should be indented 4 characters, as in:
<pre>
itcl_class MyClass {
    inherit MyParent
    constructor {config} {
        Oneline constructor command
    }
}
</pre>
Closing brackets should be on a line by themselves, aligned with
the beginning of the line that contains the open bracket.
<p>
Long lines (which are common especially for Tk commands)
should be broken up into many small lines.  Continuation lines
are indented by 8 characters, as in
<pre>
        $prefix.m.edit.menu add command &#92
                -label "Select All" &#92
                -underline 0 &#92
                -accelerator "C-/" &#92
                -command "$this selectall"
</pre>
Notice that the line breaks are carefully chosen so
that the options are easy to identify.  Avoid the following
variant:

<pre>
        $prefix.m.edit.menu add command &#92
                -label "Select All" &#92
                -underline 0 -accelerator "C-/" &#92
                -command "$this selectall"
</pre>
Glancing at this, it is easy to miss the <CODE>-accelerator</CODE>
option.

 <P>If you have a long <CODE>puts</CODE> statement, you can use
backslashes to make the text more readable.  Note that each backslash
introduces a space in the output.
<pre>
        puts "This is a long line &#92
             that extends over a few\n&#92
             lines"
</pre>

<h2><a name="comments">Comments</a></h2>

 <P>The <A HREF="../../lib/tydoc/doc/index.html"><CODE>tydoc</CODE></A>
system automatically generates html documentation from the source
code file, so the comments should follow the <CODE>tydoc</CODE>
<A HREF="../../lib/tydoc/doc/overview.html#comment format conventions">comment format conventions</A>.

The <a href="../../editors/textedit/templates/ItclTemplate.itcl">Itcl
template</a> file contains a template of an itcl file with the
appropriate copyright and comment formats.

The Itcl editor has a
<A
HREF="../../editors/textedit/doc/usersGuides/EditItclHelp.html#Itcl
Editor File Template">file template menu choice</A>
that will insert the Itcl template file

<MENU>
<LI> Comments should include honest information about the limitations of
the object definition.

<LI> Comments should be complete sentences and complete thoughts.

</MENU>
The Itcl editor contains a menu choice
that will create a <A HREF="../../editors/textedit/doc/usersGuides/EditItclHelp.html#Itcl Editor Body Template">Itcl body template</A>.

<h2><a name="names">Names</a></h2>

All programming languages have a global namespace.  In itcl, it's class
names, global variables, and procedure names.  Choose names carefully.
In particular,
<ul>
<li> All <a href="#global">global variables</a> in Tycho should begin
     with "ty" and should be documented. The documentation is
     temporarily being collected in the file "doc"
     in the main Tycho directory.
<li> All procedure names should begin with "ty" unless they already
     existed in pigi, in which case they should begin with "ptk" and
     should be backward compatible.
</ul>
In itcl, there is no limit to name sizes (as it should be).
Do not hesitate to use long names.
<p>
When naming objects, use automatic naming as much as possible.
For any itcl class that does not define a top-level window,
the syntax is:

<pre>
Classname #auto ?options?
</pre>

If the class defines a top-level window (i.e. it eventually inherits
GTopLevel), then you should use the syntax

<pre>
Classname [autoname .classname] ?options?
</pre>

The autoname procedure is defined in Tycho and returns a class
name that is constructed by appending to the single argument
an underscore and an integer that ensures that the name will be unique.

<h2><a name="global">Global Variables</a></h2>

Global variables are almost entirely unnecessary in itcl.
If you need a global variable, use a "common" variable in a class.
Note that at least one instance of the class must have been created
for the common variable to exist. (Apparently, it can have been
deleted as well).
<p>
There appears to be one circumstance in which global variables
are needed.  A Tk checkbutton object generally has a global
variable associated with it.  There appears to be no way to
use a common variable for this (that I have found).
The name of the global variable should begin with "ty",
and its existence should be documented, as explained
<a href="#names">above</a>.

<h2><a name="documentation">Documentation</a></h2>

Tycho documentation will be entirely in html and will be designed
primarily for use on-line.  Documentation for the code
(analogous to the Ptolemy Kernel Manual) will be generated
automatically from the comments in the code.
You may anticipate this by inserting HTML formatting in these
comments.  However, do not do this at the expense of readability.
We can automate a certain amount of formatting, such as blank
lines turning into paragraph breaks.
<p>
User documentation for your objects should be written
in HTML.  We should devise a strategy to keep that documentation
together with the code it is documenting.

<h2><a name="copyright">Copyright and Acknowledgements</a></h2>

We would prefer to be able to release Tycho with the 
<A HREF="../../copyright">standard UCB copyright</A>,
which allows for subsequent commercialization.
However, this is a large project, and we should use existing
code as much as possible.  The following scenarios are possible:
<ul>
<li> An uncopyrighted program (public domain) is used either verbatim
or as inspiration.  In this case, it is essential to acknowledge the
author and institution originating the code, but this has no effect
on our copyright policy.

<li> A copylefted program (under the Gnu public license) is used
as insipiration.  If there is no verbatim code used, then it
is sufficient (and necessary) to acknowledge the author and
institution.

<li> A copylefted program or portion of a program is used verbatim.
This will place the entire Tycho program under the Gnu public license,
and therefore should be done only with good reason.  However, we are
not averse to doing this.  If you include copylefted code,
<em>be sure to identify every line of code that is borrowed in this
way</em>.  This will allow us (or someone else) to later rewrite this
code and liberate Tycho from the copyleft.

</ul>
In all cases, any foreign code that you use should be carefully
read and tested.  Yes, it should be read!
Preferably, it should be reformmated to fit our programming
style, but if it is a large piece of code, it is probably not
worth doing.  We will need to devise a scheme to avoid
confusing the automatic documentation generator.
If it is Tcl/Tk code, it <em>must</em> be ported to Tk 4.0
(a nontrivial task).  If it is not itcl code, it should
be carefully searched for namespace violations.

<h3><a name="SCCS and copyrights">SCCS and copyrights</a></h3>

Currently we are using the &#37Q&#37 sccs
directive to adjust the copyright dates automatically.  The
copyright should have &#37Q&#37 as the ending date of the copyright:
1990-&#37Q&#37
If you are setting up a new directory, then you should do:
<pre>
sccs admin -fq1995 SCCS
</pre>
	
to set the <CODE>Q</CODE> variable in the SCCS directory.  Note that after
doing the sccs admin command, 'make sources' will check out
all the files in that directory.  If you are adding a new
file, you can do:
	
<pre>
sccs admin -fq1995 SCCS mynewfile.cc
</pre>

<h3><a name="copyright for Itcl files">Copyright for Itcl files</a></h3>

The <a href="../../editors/textedit/templates/ItclTemplate.itcl">Itcl
template</a> file contains the appropriate copyright to be used for
Itcl files at UC Berkeley.  Other sites may want to substitute in
their own template.  The Itcl editor has a
<A
HREF="../../editors/textedit/doc/usersGuides/EditItclHelp.html#Itcl
Editor File Template">file template menu choice</A>
that will insert the Itcl template file

<h2><a name="proofread">Proofread</a></h2>

Software has become a publication medium.  People will read your code.
Your name is on it, so you want to be proud of it.  It seems that most
people stop working on the code when it "works."  This is like stopping
work on a paper when what it says is correct, and not worrying at all
about how it is said.  PROOFREAD YOUR CODE AFTER YOU'VE GOTTEN IT WORKING.

<p>
<a href="../../doc/index.html">Tycho Home Page</a><br>
<HR>
Copyright &#169 1996, The Regents of the University of California.
All rights reserved.
<br>
Last updated: $Date$,
comments to: <author>eal@eecs.berkeley.edu</author>
</body>
</html>

