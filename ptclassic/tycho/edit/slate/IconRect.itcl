#########################################################################
# @Version: $Id$
# @Author: H. John Reekie
#
# @Copyright (c) 1996-1997 The Regents of the University of California.
# All rights reserved.
# 
# Permission is hereby granted, without written agreement and without
# license or royalty fees, to use, copy, modify, and distribute this
# software and its documentation for any purpose, provided that the
# above copyright notice and the following two paragraphs appear in all
# copies of this software.
# 
# IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY
# FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
# ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
# THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
# 
# THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES,
# INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
# PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
# CALIFORNIA HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES,
# ENHANCEMENTS, OR MODIFICATIONS.
# 
# 						PT_COPYRIGHT_VERSION_2
# 						COPYRIGHTENDKEY
##########################################################################


# Explicitly load the superclass. I don't really know why this is
# needed, but the common arrays get upset otherwise.
namespace ::tycho {
    if { [::info classes IconItem] == "" } {
	uplevel #0 {source $tychoslate/IconItem.itcl}
    }
    if { [::info classes LabeledRect] == "" } {
	uplevel #0 {source $tychoslate/LabeledRect.itcl}
    }
}

########################################################################
## IconRect
#
# <i>IconRect</i> is a labeled rectangle with connecting terminals on
# it, intended for use as an icon in block diagrams and the like. I
# has just two coordinates, which are the _x_ and _y_ coordinates
# of its anchor point.
# 
# <p><b>Options</b>:
# 
# _IconRect_ has all options of <a href="IconItem.html">IconItem</a>
# and <a href="LabeledRect.html">LabeledRect</a>.
#
# </ul>
# 
# <p><b>Components</b>
#
# _IconRect_ has all components of <a href="IconItem.html">IconItem</a>
# and <a href="LabeledRect.html">LabeledRect</a>. In addition, each
# terminal is a component.
# 
# <p><b>Bugs</b>: If a terminal is highlighted and the icon
# is resized, the highlight moves the wrong way...
# 
# <p><b>Example</b>: Create an icon:
# <tcl quiet><pre>
#   source $tycho/editors/slate/doc/internals/newslate.itcl
#   set icon [$slate create IconRect 100 100 &#92
#       -color green &#92
#	-graphics {rectangle 20 20 80 80; &#92
#                  line 20 20 80 80; &#92
#                  line 20 80 80 20} &#92
#       -text {A Sample Icon} &#92
#       -tags moveable]
# </pre></tcl>
#
# When first created, the icon has no terminals.
# To create, call the terminal{} method:
# <tcl quiet><pre>
#   $slate call $icon terminal input Terminal 0 0 &#92
#       -anchor {50 0} &#92
#       -direction {0 -1} &#92
#       -type input &#92
#       -style doublearrow
#   $slate call $icon terminal output Terminal 0 0 &#92
#       -anchor {50 100} &#92
#       -direction {1 0} &#92
#       -type output &#92
#       -style arrow -fill red
# </pre></tcl>
# 
# The actual terminal items can be queried with the slate's
# component{} method:
# <tcl quiet><pre>
#   $slate highlight [$slate component $icon input]
# </pre></tcl>
#
# The icon's size can be changed with the *-hsize* and *-vsize*
# options:
# <tcl quiet><pre>
#   $slate itemconfigure $icon -hsize 80 -vsize 30
# </pre></tcl>
#
# It can also have an anchor other than the default (the center):
# <tcl quiet><pre>
#   $slate itemconfigure $icon -anchor nw
#   update; after 500
#   $slate itemconfigure $icon -hsize 60
# </pre></tcl>
#
# <p><b>Enhancements</b>: (none)
#
# <p><b>Links</b>
# 
# <ul>
# <li><a href="../internals/howtoread.html">Reading <i>ComplexItem</i>
# documentation</a>.
# <li><a href="../internals/items.html">Complex item classes</a>.
# </ul>
#
class ::tycho::IconRect {
    inherit ::tycho::IconItem

    ###################################################################
    ####                         public procs                      ####

    # Create a new item
    proc construct {id canvas slate tags x y args}

    # Draw a highlight around the frame
    proc highlight {id canvas slate args}
    
    ###################################################################
    ####                         private variables                ####

    # All methods are looked up through a table
    private common methodtable

    # All options have a default value
    private common optiondefault

    ###################################################################
    ####                       class initialization                ####

    #### Set method table
    array set methodtable [@scope ::tycho::LabeledRect array get methodtable]
    array set methodtable [array get ::tycho::IconItem::methodtable]

    set methodtable(_coords)     ::tycho::LabeledRect::coords

    set methodtable(construct)   ::tycho::IconRect::construct
    set methodtable(highlight)   ::tycho::IconRect::highlight

    #### Set option defaults
    array set optiondefault [@scope ::tycho::LabeledRect \
            array get optiondefault]
    array set optiondefault [array get ::tycho::IconItem::optiondefault]
}

##########################################################################
#### construct
#
body ::tycho::IconRect::construct {id canvas slate tags x y args} {
    # Initialize the options
    foreach {opt val} [concat [array get optiondefault] $args] {
	set option([string trimleft $opt -]$id) $val
    }
    set anchor $option(anchor$id)
    set option(anchor$id) nw

    # Create the oval.
    eval [list ::tycho::LabeledRect::_construct $id $canvas $slate $tags] \
            $x $y [expr $x + $option(hsize$id)] [expr $y + $option(vsize$id)]

    # Adjust anchor
    _anchor $id $canvas $slate $anchor
}

##########################################################################
#### highlight
#
# Draw a highlight around the main icon. This is so the highlight
# appears around the icon, not around the outside of the terminals,
# which looks a bit rough.
#
body ::tycho::IconRect::highlight {id canvas slate args} {
    eval $canvas create rectangle [$canvas bbox $primary($id)] $args
    $slate lower highlight.$id $id
}
