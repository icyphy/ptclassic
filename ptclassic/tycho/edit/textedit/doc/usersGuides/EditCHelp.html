<!-- $Id$ -->
<html>
<head>
<Title>User's Guide to the C Editor</title>
</head>
<body bgcolor="#faf0e6">
<h1><a name="C editor">User's Guide to the C Editor</a></h1>
<p>
This class provides a text editor specialized for editing
C files.
It is invoked automatically when opening any file with the
<a name=".c extension"><CODE>.c</CODE> extension</a> 
in its name.
The <a name="EditC class">EditC class</a> is derived from the
<a href="EditProgramHelp.html">EditProgram class</a>, and
therefore inherits all of its features.

<H2><A NAME="compiling C files">Compiling C Files</A></H2>

The C Editor has two menu choices to compile the current file:
<CODE>Compile</CODE> and <CODE>Compile and Load</CODE>.
 <P>The <CODE>Compile</CODE> choice brings up the Monitor widget which 
will run <CODE>make</CODE> and compile the current file.

 <P>The <CODE>Compile and Load</CODE> menu choice
will compile the current file and load it back
into Tycho by using the Tcl <A
HREF="../../../../doc/itclhtml/tcl/load.n.html"><CODE>load</CODE></A>
command.  The <CODE>Compile and Load</CODE> menu choice can be used
to create new Tcl commands that are written in C.
Note that it is risky to test C code within Tycho, since failure
of the C code could cause Tycho to crash.

 <P>When a C file is compiled and loaded, the following steps occur.
<OL>

<LI> If the Tcl <CODE>load</CODE> command is to work on a particular
file, then there must be a Tcl initialization procedure in the C file
(see below for details).  The <CODE>Add Tcl Initialization</CODE>
choice under the <CODE>Special</CODE> menu will add an initialization
procedure.

 <P>Since Tycho can't know what commands you want to register, the
initialization procedure will have a body that must be modified by the
user.

<LI> The current directory is searched for the following files:
	<OL>
	<LI> <CODE>makefile</CODE>
	<LI> <CODE>Makefile</CODE>
	<LI> A file with the same base as the file being evaluated and
	a <CODE>.mk</CODE> extension.  For example, if the file being
	evaluated is named <CODE>myTclCommands.c</CODE>, then we look for 
	<CODE>myTclCommands.mk</CODE>
	</OL>

If none of the above makefiles are found, then we create a makefile
with the same basename, as #3 above.  The details of the makefile are
covered below.

<LI> A <CODE>make</CODE> command is executed with the makefile
determined from the step above.  Continuing our example above, the
command would be <CODE>make -f myTclCommand.mk</CODE>.

<LI> The Tcl <CODE>load</CODE> command is called.  The
<CODE>load</CODE> command is passed the architecture dependent shared
object filename.

</OL>

<H3>Generating a makefile</H3>

If a makefile does not exist, then when a C file is evaluated, a
makefile can be generated.  The makefile will have the same basename
as the C file, and a <CODE>.mk</CODE> extension.

 <P>The template that is used is located at <A
HREF="../../templates/Cmakefile.mk"><CODE>$TYCHO/editors/textedit/templates/Cmakefile.mk</CODE></A>.

 <P>The template includes two makefiles: <A
HREF="../../../../obj.$PTARCH/java.mk"><CODE>$TYCHO/obj.$PTARCH/java.mk</CODE></A>
and <A
HREF="../../../../obj.$PTARCH/tcl.mk"><CODE>$TYCHO/obj.$PTARCH/tcl.mk</CODE></A>
These two makefiles are generated by running <CODE>configure</CODE>.
The Tcl extensions use these file as well, see 
<A HREF="../../../../doc/coding/buildtclexts.html"><CODE>$TYCHO/doc/coding/buildtclexts.html</CODE></A> for details.

 <P>If these two makefiles are not present, then <CODE>make
config_tclexts</CODE> is called while in the <CODE>$TYCHO</CODE>
directory.

<H3>Initialization Procedure</H3>

The Tcl <CODE>load</CODE> command invokes an initialization procedure
after loading the shared object.  The name of the initialization
procedure depends on the file name of the shared object, or on the Tcl
package name.  See the
<A
HREF="../../../../doc/itclhtml/tcl/load.n.html"><CODE>load</CODE></A>
command for the details, but if the shared object is named <CODE>myTclCommand.so</CODE>, then the initialization procedure would be
<PRE>
int Mytclcommand_InitProc(Tcl_Interp *interp)
</PRE>

Usually the initialization procedure registers commands, for example
<PRE>
int Mytclcommand_InitProc(Tcl_Interp *interp)
{
    Tcl_CreateCommand (interp, "mytclcommand", Tcl_MyTclCommandCmd, 
                       (ClientData) infoPtr, (Tcl_CmdDeleteProc*) NULL);
    return TCL_OK;
}
</PRE>

<p>
<a href="../../../../doc/index.html">Tycho Home Page</a><br>
<p>
<HR>
Copyright &#169 1996-%Q%, The Regents of the University of California.
All rights reserved.
<br>
Last updated: $Date$,
comments to: <author>eal@eecs.berkeley.edu</author>
</body>
</html>
