<!-- $Id$ -->
<html>
<head>
<Title>User's Guide to the Profile Tcl Tool</title>
</head>
<body bgcolor="#faf0e6">
<h1><a name="profile tcl tool">User's Guide to the Profile Tcl Tool</a></h1>
<p>
This class provides a visual editor specialized for profiling
the execution of tcl and tcl code.
The profiler is derived from the
<a href="EditForestHelp.html">EditForest class</a>, and
therefore inherits all of its features.
<p>
The <A HREF="../../../../doc/coding/index.html">Tycho Programmer's Manual</A>
includes a section on <A HREF="../../../../doc/coding/performance.html">Performance in Tcl</A>.

<H2><A NAME="tclX profile command">TclX profile command</A></H2>

The Profile Tcl tool uses the TclX <CODE>profile</CODE> command.  TclX
is an extension to Tcl.  The TclX sources are available at <A
HREF="ftp://ftp.neosoft.com/pub/tcl/tclx-distrib"><CODE>ftp://ftp.neosoft.com/pub/tcl/tclx-distrib</CODE></A>.
To use the Profile Tcl tool, you must have the TclX <CODE>profile</CODE>
command available at runtime.

 <P>When the Profiler is started, the Tycho <A
HREF="../../../../kernel/doc/usersGuides/LoaderHelp.html">Loader</A>
will look for the TclX shared library that contains the
<CODE>profile</CODE> command and attempt to load it.

 <P>To use the Profiler, you must have the <CODE>profile</CODE> command.
There are several different scenarios, pick the scenario that fits
you situations best and follow the instructions below. 
<MENU>
<LI> <A HREF="#profile command, default TclX">Use the default TclX
	profile command</A>
<LI> <A HREF="#profile command, TclX patch">Patch the TclX profile
	command and Reinstall TclX</A>
<LI> <A HREF="#profile command, standalone version">Compile a
	standalone profile command</A>
</MENU>

<H3><A NAME="profile command, default TclX">Use the default TclX
profile command</A></H3>

 <P>The <CODE>profile</CODE> command shipped with TclX7.6.0 has
a bug that causes coredumps if used with Itcl.
The file <A
HREF="tclXprofile.c.patch"><CODE>tclXprofile.c.patch</CODE></A> is a
patch to <CODE>tclX7.6.0/tcl/generic/tclXprofile.c</CODE> that
fixes the bug.  
	
<H3><A NAME="profile command, TclX patch">Patch the TclX profile command and Reinstall TclX</A>
</H3>

 <P>To install this patch, you will need Larry Wall's
<CODE>patch</CODE> program.  (You can get <CODE>patch</CODE> from <A
HREF="ftp://ptolemy.eecs.berkeley.edu/pub/gnu/src/patch-2.1.tar.gz"><CODE>ftp://ptolemy.eecs.berkeley.edu/pub/gnu/src/patch-2.1.tar.gz</CODE></A>).
To install the patch
<OL>
<LI> Grab the TclX sources from
<A
HREF="ftp://ftp.neosoft.com/pub/tcl/tclx-distrib"><CODE>ftp://ftp.neosoft.com/pub/tcl/tclx-distrib</CODE></A>.

<LI> <CODE>cd </CODE>to 
	<CODE>tclX</CODE><I>version</I><CODE>/tcl/generic</CODE>.

<LI> Patch <CODE>tclXprofile.c</CODE> <CODE>patch &lt;
$TYCHO/editors/visedit/doc/usersGuides/tclXprofile.c.patch</CODE>.

<LI> Install TclX by following the TclX instructions.

</OL>

<H3><A NAME="profile command, standalone version">Compile a standalone profile command</A>
</H3>

The directory <CODE>$TYCHO/lib/profile</CODE> contains a standalone
version of <CODE>tclXprofile.c</CODE> that can be configured and
compiled to produced a shared object that can be loaded in to Tycho
when profiling starts.  The Tycho Loader facility will bring up a file
browser if TclX cannot be found, and you can enter the pathname of the
<CODE>tclXprofile</CODE> object.
 <P>

Compiling <CODE>tclXprofile.c</CODE> requires the tcl sources, since
the .c file uses <CODE>tclInt.h</CODE>, which is not usually
installed.  If you are compiling <CODE>tclXprofile.c</CODE> from
within Ptolemy, then you can use the default settings in
<CODE>$TYCHO/lib/profile/makefile</CODE>.  If you are not compiling
from within Ptolemy, you will have to set the
<CODE>TCL_SRC_INCLUDE_DIR</CODE> makefile variable.
 <P>

Compiling <CODE>tclXprofile.c</CODE> also requires
<CODE>tclConfig.sh</CODE>, which is usually in the architecture
dependent tcl <CODE>lib</CODE> directory.  Again, if you are
installing from within Ptolemy, then the makefile is probably fine.
Otherwise you will have to adjust the <CODE>TCLCONFIGSH</CODE>
makefile variable.
 <P>
There are two ways to adjust these variables:
<OL>
<LI> Edit <CODE>$TYCHO/lib/profile/makefile</CODE>
After you have adjusted the makefile accordingly, configure and build
the shared object:
<PRE>
 <CODE>cd $TYCHO/lib/profile; make</CODE>
</PRE>
<LI> Or, Pass the new values as command line options:
<PRE>
cd $TYCHO/lib/profile
make TCL_SRC_INCLUDE_DIR=$PTOLEMY/src/tcltk/itcl2.1/tcl7.5/generic/ \
	$PTOLEMY/tcltk/itcl.$PTARCH/lib/itcl/tclConfig.sh
</PRE>
</OL>


The <CODE>tclXprofile</CODE> shared object will be in
<CODE>$TYCHO/lib/profile/$PTARCH</CODE>.  Under Solaris, the file will
be named <CODE>tclXprofile.so</CODE>.

<HR>
<H2>Profiler Description</H2>

<p>
The profiler consists of the usual tycho menu bar with a few buttons,
a graphical forest editor, a few counters and a the tycho status bar.
We describe each in turn.

<HR>
<H3>Profiler Buttons</H3>

<DL>
<DT> <CODE>Start Profiling</CODE>
<DD> This button calls the TclX <CODE>profile on</CODE> command.  To
profile the execution of your code, hit the <CODE>Start
Profiling</CODE> button, execute your code, and hit the <CODE>Display
Profile</CODE> button.

<DT> <CODE>Display Profile</CODE>
<DD> This button stops the TclX profiler and processes the profiler
output.  For large runs, the processing of the data could take a
moment, tcl is traversing large arrays.

<DT> <CODE>Cancel Profile</CODE>
<DD> This button stops the TclX profiler, but does not display the output.

</DL>

<HR>
<H3>Profiler Grapher</H3>

The central area of the Profiler is a <a
href="EditForestHelp.html">Forest editor</a>.  After generating a
profile, the user can follow the execution of the tcl code by clicking
on nodes in the graph.  As the mouse moves over nodes in the graph,
the counters at the bottom of the screen display statistics about that
node.

<HR>
<H3>Profiler Counters</H3>

At the bottom of the Profiler are a series of counters.  These
counters display statistics about the forest node that the mouse last
passed over.  As the mouse moves over a counter, the status window
displays a short description about that counter.

<p>
<a href="../../../../doc/index.html">Tycho Home Page</a><br>
<p>
<HR>
Copyright &#169 1996-%Q%, The Regents of the University of California.
All rights reserved.
<br>
Last updated: $Date$,
comments to: <author>tycho@eecs.berkeley.edu</author>
</body>
</html>
