<!-- $Id$ -->
<html>
<head>
<Title>Dialog Classes</Title>
</head>
<body bgcolor="#faf0e6">
<h1><a name="dialog classes">Dialog Classes</a></h1>
<p>
Tycho provides a set of classes for asking the user questions.
These can be <a name="yes-no questions">yes-no questions</a>,
questions that require a <a name="typed response questions">typed response</a>,
or questions that require a file name response.
<h2>Contents</h2>
<ul>
<li><a href="#YesNoQuery class">YesNoQuery Class</a>
<li><a href="#YesNoCancel class">YesNoCancel Class</a>
<li><a href="#Query class">Query Class</a>
<li><a href="#FileBrowser class">FileBrowser Class</a>
</ul>
<h2><a name="YesNoQuery class">YesNoQuery Class</a></h2>
<p>
The YesNoQuery class poses a question and offers two buttons,
labeled "Yes" and "No".  For example:
<tcl><pre>
::tycho::YesNoQuery .y -text {Are you awake?} &#92
    -yescommand {::tycho::inform {You said yes!}} &#92
    -nocommand {::tycho::inform {Then how did you click on the No button?}}
.y centerOnScreen
</pre></tcl>
The options "<a name="yescommand option">-yescommand</a>" and
"<a name="nocommand option">-nocommand</a>" specify scripts to be executed
in response to these buttons.  The default scripts simply destroy
the window and return 0 or 1, but the return value is lost.
To get the return value, you should use the
"<a href="dialogwindow.html#newModal procedure">newModal</a>" procedure.
For example,
<tcl><pre>
if [::tycho::DialogWindow::newModal YesNoQuery .z -text {Are you awake?}] {
    ::tycho::inform {You said yes!}
} {
    ::tycho::inform {Then how did you click on the No button?}
}
</pre></tcl>

<p>
There is a bit of a technicality with using this capability.
Suppose you wish to create a dialog box that returns the strings
"yes" or "no" instead of 0 or 1.  The -yescommand and -nocommand
options specify Tcl scripts, and it is difficult to get a Tcl
script to return a value.  You could use the "set" command as
follows:
<tcl><pre>
set x [
    ::tycho::DialogWindow::newModal YesNoQuery .z -text {Are you awake?} &#92
         -yescommand {set y {yes}} &#92
         -nocommand {set y {no}}
]
::tycho::inform "Your answer was $x"
</pre></tcl>
But this not good coding style.  The variable "y" gets set
at the global scope, clobbering any previous value the user might
have unwisely stored in y.  The DialogWindow class provides
a procedure
<a name="answer procedure">
"answer"
</a>
that simply returns its argument precisely
for this purpose.  Thus, the preferred script is:
<tcl><pre>
set x [
    ::tycho::DialogWindow::newModal YesNoQuery .z -text {Are you awake?} &#92
        -yescommand {::tycho::DialogWindow::answer {yes}} &#92
        -nocommand {::tycho::DialogWindow::answer {no}}
]
::tycho::inform "Your answer was $x"
</pre></tcl>

<p>
<h2><a name="YesNoCancel class">YesNoCancel Class</a></h2>7

<p>
The YesNoCancel class is like the YesNoQuery class, but there is one
more button labeled "Cancel" and one more option
<a name="cancelcommand option">-cancelcommand</a>.
To see an example, execute this:
<tcl><pre>
set x [::tycho::DialogWindow::newModal YesNoCancel .z -text {Are you awake?}]
::tycho::inform "The value returned was $x"
</pre></tcl>
By default, the cancel button returns -1.

<p>
<h2><a name="Query class">Query Class</a></h2>
<p>
The <code>Query</code> class opens a dialog box with one or more
<a name="text entry">text entry widgets widgets</a>
and/or <a name="radio button widgets">radio button widgets.</a>
It is used by the "<a href="dialogs.html#query procedure">query</a>"
and "<a href="dialogs.html#queryinfo procedure">queryinfo</a>"
procedures, which provide simpler interfaces.
You can also create instances of it directly.
<p>
The actions taken in response to the OK and Cancel buttons
are given by the <i><a name="okcommand option">-okcommand</a></i> and
<i><a name="cancelcommand option">-cancelcommand</a></i> options.
By default, the OK button just returns the user responses.
The Cancel does nothing.  After either command is executed,
the widget is destroyed.
<p>
The <code>Query</code> class creates a dialog box with any of
several types of interactions with the user.
Text entry boxes can be created using the
<a name="line method"><code>line</code></a> method, as shown here:
<tcl><pre>
::tycho::Query .bb -okcommand {::tycho::inform [.bb get]}
.bb line month {Enter Month} Jan
.bb line day {Enter Day} Mon
.bb centerOnScreen
</pre></tcl>
<p>
This method takes three arguments,
a tag, a label, and a default string.
An alternative method allows you to create multi-line
text edit boxes, as in the following example:
<tcl><pre>
.bb lines third {Third entry:} {Yet another default} 4
</pre></tcl>
<p>
Now the query will four lines and that the OK button
is no longer triggered by &lt;Return&gt;.  It can now be triggered by
&lt;Meta-Return&gt;.  This is because in a multi-line entry box, &lt;Return&gt;
moves the insertion cursor to a new line.
<p>
Notice in the above example that Control-Tab moves the insertion
cursor from query to query.  Within a radio button, it moves the focus
from button to button.  The Space key selects the current button.
If there are no multi-line entries, the Tab key can be used instead.
<p>
The <code><a name="radio method">radio</a></code> method
puts radio buttons into the dialog.  For example, assuming you
have not dismissed the Query that you created above,
<tcl><pre>
.bb radio selmonth {Select Month} {Jan Feb March} Jan
.bb radio selday {Select Day} {Mon Tue Wed Thu Fri} Mon
</pre></tcl>
<p>
The arguments are a name for the bank of buttons, a label,
the list of possible values, and the default selection.
<p>
The <code>get</code> method, invoked above on clicking the OK button, returns
an indexed list of entries.  A modal dialog can be created as well,
and will return the values in the same form as the <code>get</code> method.
For example,
<tcl><pre>
::tycho::Query .bb
.bb line text {Enter Something} {foo bar}
.bb radio select {Select One} {First Second Third} First
::tycho::post [::tycho::DialogWindow::wait .bb]
</pre></tcl>
<p>
Notice that it was no longer necessary to specify a
<i>-okcommand</i> option.
<p>
The list returned by the <code><a name="get method">get</a></code>
method has the form {tag value tag value ...}. This form can be used to
set the contents of an array using <code>array set</code>, providing a
very simple way to access multiple responses.
<p>
It is also possible to have queries that are mediated by some other
widget.  For example,
<tcl><pre>
::tycho::Query .bb -entrywidth 70
.bb mediated color {Color:} red {::tycho::querycolor {Choose color}}
.bb mediated font {Font:} fixed ::tycho::queryfont
::tycho::post [::tycho::Dialog::wait .bb]
</pre></tcl>
<p>
Here, the query takes the form of a pushbutton.
Pushing this button invokes another widget (in this case the
<code>ColorBrowser</code> or
<code>FontBrowser</code>), which mediates the selection of a value.
<p>
The <i><a name="queries option">-queries option</a></i> specifies the initial
list of entry boxes that will appear in the window, and can be used
to create an entire dialog all at once.
The value of this option should be a list of queries, where each
query is a list beginning with a type keyword.
This keyword is actually a method name for the <code>Query</code>
class.  Here is a summary of the arguments associated with each
method:
<menu>
<li> line tag label default
<li> lines tag label default height
<li> radio tag label possibilities default
<li> mediated tag label default command
</menu>
In addition, all four can accept any number of additional arguments.
These arguments are passed to the widget that implements the query
(a Tk entry, a Tycho Edit, a set of Tk radio buttons, or a single Tk
button, respectively).  These additional arguments can be used to
control the appearance of the query.
<p>
The arguments above are explained below:
<menu>
<li> tag: a string that uniquely
     identifies the query. No two queries in the same dialog box
     can have the same tag.
<li> label: a string that is inserted in the display to the left
     of the query.
<li> default: the initial value of the query.
<li> height: the number of lines in a multi-line text query.
     An <code>Edit</code> widget is used, providing
     an emacs-like text editor.
<li> possibilities: a list of button names.  These are the labels
     that appear on each of the radio buttons.
<li> command: a command to invoke for a mediated query.  Before
     invoking this command, the current (default) value of the
     query will be appended to the command, separated by a space.
     The command should return the new value of the query.
</menu>
For example,
<tcl><pre>
::tycho::Query .z &#92
    -queries { &#92
        {line first {First query:} {Default string}} &#92
        {lines second {Second query:} {Another default} 4}  &#92
        {radio third {Third query:} {A B C D} A}  &#92
        {mediated fourth {Fourth entry:} red {::tycho::querycolor Choose}}  &#92
     } &#92
    -okcommand {::tycho::inform "Result of a get: [.z get]"} &#92
    -cancelcommand {::tycho::inform "You canceled"}
.z centerOnScreen
</pre></tcl>
<p>
The <code><a name="remove">remove</a></code> method
takes a tag as an argument and simply removes the corresponding query.
<tcl><pre>
.z remove first
</pre></tcl>
<p>
The <code>get</code> method may also specify a particular tag.
<tcl><pre>
::tycho::inform [.z get second]
</pre></tcl>
<p>
The <a name="clear method">clear method</a>
clears all defaults (or a single default, if
a tag argument is given).
<tcl><pre>
.z clear
</pre></tcl>
<p>
The <a name="insert method">insert method</a>
inserts a string into the specified entry.
<tcl><pre>
.z insert second {An inserted string. }
</pre></tcl>
<p>
You may delete this window by clicking on the OK button.
<p>
The class is derived from <a href="dialogwindow.html">Dialog</a>,
so it has the
options -text, -bitmap, and -title, which control the text
of the query, a bitmap left of the query, and a window manager title.
For example,
<tcl><pre>
::tycho::Query .aa &#92
    -bitmap questhead &#92
    -text {Enter modified values, then click OK} &#92
    -queries {{line first {First entry:} {Default string}} &#92
        {line second {Second entry:} {Another default}}}  &#92
    -title "Query Widget" &#92
    -okcommand {::tycho::inform "Result of a get: [.aa get]"} &#92
    -cancelcommand {::tycho::inform "You canceled"}
.aa centerOnScreen
</pre></tcl>
<p>
The order of the -bitmap and -text options relative to the -queries
option is important.  In most circumstances, you will want them first.
<p>
You also have access to the "new" method of the base class.
For example,
<tcl><pre>
::tycho::Dialog::new &#92
    Query .z -queries {{line n {Enter value} {default}}}
</pre></tcl>
<p>
<h2><a name="FileBrowser class">FileBrowser Class</a></h2>
A rather more elaborate dialog box is a file browser.
Consider the example:
<tcl><pre>
::tycho::FileBrowser .f -command "::tycho::inform"
wm deiconify .f
</pre></tcl>
The <a name="command option">-command option</a>
specifies a command to execute once the user
has selected a file name.  The file name is appended as an argument
to the command before the command is executed.  Thus, in this example,
if you select a file named "foo" in directory /users/bar/, then
the command that is executed will be "::tycho::inform /users/bar/foo".
Refer to the <a href="../usersGuides/FileBrowserHelp.html">user-level documentation</a>
for further information about the file browser.
<p>
As usual, you can get a modal file browser using newModal.
<tcl><pre>
::tycho::inform [::tycho::Dialog::newModal FileBrowser .w]
</pre></tcl>
<p>
<a href="../../../doc/index.html">Tycho Home Page</a><br>
<p>
<HR>
Copyright &#169 %Q%, The Regents of the University of California.
All rights reserved.
<br>
Last updated: %D%,
comments to: <author>eal@eecs.berkeley.edu</author>
</body>
</html>
