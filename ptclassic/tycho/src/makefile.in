# Makefile for Ptolemy Tycho system, src directory. These dirs use the compiler
#
# Author: Christopher Hylands
# Version: $Id$
#
# Copyright (c) 1996-%Q% The Regents of the University of California.
# All rights reserved.
# 
# Permission is hereby granted, without written agreement and without
# license or royalty fees, to use, copy, modify, and distribute this
# software and its documentation for any purpose, provided that the
# above copyright notice and the following two paragraphs appear in all
# copies of this software.
# 
# IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY
# FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
# ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
# THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
# 
# THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES,
# INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
# PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
# CALIFORNIA HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES,
# ENHANCEMENTS, OR MODIFICATIONS.
# 
# 						PT_COPYRIGHT_VERSION_2
# 						COPYRIGHTENDKEY
##########################################################################

# This file is a makefile for the Tycho files that require compilation.
# If it has the name "makefile.in"
# then it is a template for a makefile;  to generate the actual makefile,
# run "./configure", which is a configuration script generated by the
# "autoconf" program (constructs like "@foo@" will get replaced in the
# actual makefile.

# We don't ship tksteal right now.  To build tksteal, uncomment it below
# edit configure.in, run autoconf and then configure.
DIRS = profile tytimer tytest tycgc @TYJAVA@ #tksteal

srcdir = 	@srcdir@

# Root of Tycho directory
ROOT =		..

ME = 		src
# True source directory
VPATH =		$(srcdir)

# Get configuration info
CONFIG =	$(ROOT)/mk/tycho.mk
include $(CONFIG)

# Files that are under version control
EXTRA_SRCS =	configure.in makefile.in

# `make realclean` removes these files
REALCLEAN_STUFF = java.mk tcl.mk makefile

# `make checkjunk` ignores these files
MISC_FILES =	java.mk tcl.mk config.cache config.log config.status \
		configure $(DIRS)

# We can't place an 'all' rule in corerules.mk, because any makefile that
# defines its own all rule would have the rule defined twice.  With
# GNU make, we could make the all rule a double-colon rule, but this might
# not be portable.
all:
	@for x in $(DIRS); do \
	    if [ -w $$x ] ; then \
		( cd $$x ; \
		echo making $@ in $(ME)/$$x ; \
		$(MAKE) $(MFLAGS) $(MAKEVARS) $@ ;\
		) \
	    fi ; \
	done

install: $(LIBDIR) $(LIBDIR)/java.mk $(LIBDIR)/tcl.mk
	@for x in $(DIRS); do \
	    if [ -w $$x ] ; then \
		( cd $$x ; \
		echo making $@ in $(ME)/$$x ; \
		$(MAKE) $(MFLAGS) $(MAKEVARS) $@ ;\
		) \
	    fi ; \
	done

$(LIBDIR):
	mkdir $@
$(LIBDIR)/java.mk:
	rm -f $@
	ln -s java.mk $@
$(LIBDIR)/tcl.mk:
	rm -f $@
	ln -s tcl.mk $@
depend:
	@echo "no dependencies in this directory"

# Get the rest of the rules
include $(ROOT)/mk/tycommon.mk

#----------------------------------------------------------------------
# Rules for rebuilding the configure and Makefile files
#----------------------------------------------------------------------

${srcdir}/configure : configure.in
	cd ${srcdir} && autoconf

config.status : configure
	configure

makefile : makefile.in config.status
	./config.status
