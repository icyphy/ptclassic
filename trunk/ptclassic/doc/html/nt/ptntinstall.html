<!-- $Id$ -->
<html>
<head>
<title>Ptolemy NT Installation</title>
</head>
<body bgcolor=#faf0e6>
<H1>Ptolemy NT Installation</H1>
The Ptolemy NT Installation is more tricky than it should be,
we hope to fix this soon.  
 <p><B>These instructions are in the process of being updated for
new versions of cygiwn and egcs.  The instructions below may
not
work with Ptolemy 0.7.1.  If you are attempting to install Ptolemy 0.7.1,
please see the instructions in $PTOLEMY/doc/html/nt.
</B>
<H2>nt4 Installation Instructions</H2>

<OL>
<LI> Download 
<a href="http://sourceware.cygnus.com/cygwin/">Cygnus GNU-win32 b20.1</a>
from
<a href="ftp://go.cygnus.com/pub/sourceware.cygnus.com/cygwin/"><CODE>ftp://go.cygnus.com/pub/sourceware.cygnus.com/cygwin/</CODE></a>

<menu>

<li> <a href="ftp://go.cygnus.com/pub/sourceware.cygnus.com/cygwin/latest/README"><CODE>README</CODE></a>
<li> Download <a href="ftp://go.cygnus.com/pub/sourceware.cygnus.com/cygwin/latest/full.exe"><CODE>full.exe</CODE></a> (14Mb)
</menu>


<LI> Install Cygnus GNU-win32 by mousing on the <CODE>full.exe</CODE>
icon.  It is best if you install Cygnus GNU-win32 in a directory that
does not have spaces in the pathname.  Usually GNU-win32 is installed
in the top level, so it ends up in <CODE>c:/Cygnus</CODE>.
Be sure to update your path and the other variables mentioned
in the Cygnus <CODE>README</CODE> file.


<li> Be sure to do <CODE>mkdir /tmp</CODE>

<li> Copy the <CODE>bash.exe</CODE> binary to <CODE>/bin/sh.exe</CODE>
for use from <CODE>make</CODE>:
<pre>
mkdir /bin
cp /Cygnus/cygwin-b20/H-i386-cygwin32/bin/bash.exe /bin
</pre>
It is possible to use the vanilla <CODE>sh.exe</CODE> rather than using <CODE>bash.exe</CODE>, but <CODE>make</CODE>
has subtle problems with the <CODE>sh.exe</CODE>.
Another problem is that <CODE>pigi</CODE> uses <CODE>csh</CODE>
style syntax to exec subprocesses in a few places, and <CODE>csh</CODE> 
style syntax is not supported by the vanilla <CODE>sh.exe</CODE>, but
it is supported by <CODE>bash.exe</CODE>.
For more information, see
<a href="ptntbugs.html#Loadingastarfails">Loading a star fails</a>.

 <p>Since the Xgraph stars and various scripts use <CODE>/bin/rm</CODE>
you should also do:
<pre>
cp /Cygnus/cygwin-b20/H-i386-cygwin32/bin/rm.exe /bin
</pre>

<li> Copy the file gcc.exe from <CODE>Cygnus/cygwin-b20/H-i386-cygwin-32/bin</CODE> to <CODE>/bin</CODE> and rename it to <CODE>cc.exe</CODE>. Otherwise
you will get problems while trying to compile xv.

<li> Create <CODE>/etc/passwd</CODE> and <CODE>/etc/group</CODE>
by running 
<pre>
mkdir /etc
mkpasswd -d -l -g > /etc/passwd
mkgroup -d -l > /etc/group
</pre>
For more information, type <CODE>mkpasswd</CODE> and <CODE>mkgroup</CODE>
without any arguments.  The Cygwin faq also covers these programs.
If you do not have <CODE>/etc/passwd</CODE>, then you will get errors
from <CODE>GetTildePath()</CODE> when trying to create an icon.
(Reported by Sascha Schwarz &lt;saschas@natasha.auslabs.lucent.com&gt;)

<li> Download X11 for b20 from 
<a href="http://www.parallax.co.uk/~andyp/"><CODE>http://www.parallax.co.uk/~andyp/</CODE></a>

 <br> Below are other possibilities:
<menu>
<li> <a href="http://sourceware.cygnus.com/cygwin/links.html">Cygwin links to software ports</a>
<li> X11 for b19, b20 <a href="ftp://www.lexa.ru/pub/domestic/sos/ports/"><CODE>ftp://www.lexa.ru/pub/domestic/sos/ports/</CODE></a>
<li> X11 for b19<a href="http://dao.gsfc.nasa.gov/software/grads/win32/X11R6.3"><CODE>http://dao.gsfc.nasa.gov/software/grads/win32/X11R6.3</CODE></a>.
</menu>


<li> Install X11R6.4:
The <CODE>bunzip2</CODE> executable is included in the Cygwin distribution.

<pre>
mkdir /usr
cd /usr
bunzip2 /tmp/x11-b20_tar.bz2
tar -xf /tmp/x11-b20_tar
</pre>



<li> Install an X server.  The 
<a href="http://dao.gsfc.nasa.gov/software/grads/win32/X11R6.3">Pre-compiled X11R6.3 Libraries/Clients For GNU Win32 B19 </a> page
has some pointers to freely available X servers.  Locally we use
<a href="http://www.hummingbird.com">Hummingbird's</a> Exceed, which
is a commercial X server package.

<li> Add <CODE>c:\usr\X11R6.4\bin</CODE> to your path by using the
<CODE>System</CODE> control panel.

<li> Verify that the X installation is working by starting up an X server
setting your DISPLAY:
<pre>
DISPLAY=localhost:0.0
export DISPLAY
</pre>
and then running <CODE>/usr/X11R6.4/bin/xclock</CODE>.
<li> To use the Java version of <a name="pxgraph"><CODE>pxgraph</CODE></a>,
download
<a href="http://www.javasoft.com/products/jdk/1.1/index.html">JDK1.1</a>.
The JDK should be installed in <CODE>c:/jdk1.1.<I>n</I></CODE>
and you will need to update your path.  

 <br>For a prebuilt X11 pxgraph binary, see:
<a href="ftp://ptolemy.eecs.berkeley.edu/pub/misc/pxgraph/index.html"><CODE>ftp://ptolemy.eecs.berkeley.edu/pub/misc/pxgraph/index.html</CODE></a>


</ol>

<h3>Building Ptolemy</h3>

<ol>

<li> Since Ptolemy has lots of small files, you are better off 
avoid FAT partitions and placing the sources on a NTFS partition.

<LI> If you have not yet done so, download the Ptolemy <CODE>src</CODE>
zip file from
<a href="http://ptolemy.eecs.berkeley.edu/pt0.7.1/download.html"><CODE>http://ptolemy.eecs.berkeley.edu/pt0.7.1/download.html</CODE></a>
and then use winzip to unzip them.
 <br>Note that there seems to be 
<a href="ptntbugs.html#tar">problem with <CODE>$PTOLEMY/colors/ptolemy/con</CODE></a>,
so you should download the zip version of the Ptolemy src
file instead of the tar version.  The tar version
of other.src and Tycho should work fine, 
if you get a warning like
<CODE>tar: Error exit delayed from previous errors</CODE>, you can ignore it.
The warning probably comes from files that 
are included twice in the tar file because of symbolic links.




<li> Building Itcl, Octtools and Ptolemy will require about 470Mb of
space for the sources, build directories and installation directories.
To save space, you can build and install Itcl and Octtools separately
and then do

<pre>
rm -rf $PTOLEMY/obj.nt4/tcltk $PTOLEMY/obj.nt4/octtools
</pre>


<li> Set up your environment by setting the variables below.  In the
<CODE>Start</CODE> menu, select <CODE>Settings</CODE>, then
<CODE>Control Panels</CODE>, then <CODE>System</CODE>, then select the
<CODE>Environment</CODE> tab

 <br> The values of <CODE>PTOLEMY</CODE> and <CODE>PTARCH</CODE> should
follow these conventions:
	<menu>
	<li> The value should not contain a colon '<CODE>:</CODE>'.
	 <brp>For example, <CODE>D:/users/ptolemy</CODE> is incorrect.
	<li> Do not use multiple slashes.  
	 <br>For example, <CODE>//D/users/ptolemy</CODE> is incorrect.
	</menu>
The values to set are:
<pre>
PTARCH nt4
PTOLEMY /users/ptolemy
CC gcc
</pre>
Set your <CODE>PATH</CODE> to include
<pre>
%PTOLEMY%/bin:%PTOLEMY%/bin.nt4
</pre>


<li> If you have <a href="http://samba.anu.edu.au/samba/">Samba</a>
setup, then start up <CODE>bash</CODE> and cd to the tree with something like: 

<pre>
mkdir /users/ptolemy
mount //<I>UnixHost</I>/ptolemy /users/ptolemy
cd $PTOLEMY
</pre>

<p>Now you have three ways to get to the sources using Samba:
<ol>

<li> Mount a Ptolemy tree located on Unix machine with the
<CODE>Run</CODE> Start menu choice.

<li> <CODE>cd</CODE> to the UNC, such as <CODE>cd //carson/ptdesign</CODE>

<li> <CODE>cd</CODE> to the Cygwin mount point: <CODE>cd /users/ptolemy</CODE>
</ol>
Note that there are two ways to run Tycho, via the native Windows 
<CODE>itkwish</CODE> or via the Cygwin32 <CODE>itkwish</CODE>.  The
Windows <CODE>itkwish</CODE> does not understand Cygwin32 mount points, but
the Cygwin32 version does.

 <p>Note that you can set PTOLEMY to the raw UNC format 
<CODE>//<I>UnixHost</I>/ptolemy</CODE>, but if you do, you will
have problems with configuring Itcl. Instead use the <CODE>mount</CODE>
command as above.

<li> To build Octtools, you will need to unset the <CODE>LIB</CODE>
environment variable:
<pre>
unset LIB
</pre>

<li> In the System control panel, set the <CODE>CC</CODE>
environment variable to <CODE>gcc</CODE>.  If you don't then
you will get errors while configuring Itcl.


<li> Edit the file <CODE>$PTOLEMY/tycho/util/tydoc/tydoc.tcl</CODE>,
inserting in line 92 the following:
<pre>
 set retval ""
</pre>
so that it will look like this:
<pre>
    set generateIndex 1
    set errorInfo ""
    set retval ""
    if [catch {set retval [::tycho::HTMLDocSys::generateHTML $verbose $debug \
</pre>


<li>  Download and ungzip
<a href="http://ptolemy.eecs.berkeley.edu/pt0.7.1/ptolemy0.7.1/html/reimer0898/pt0.7.1p1.ptclInvokeInterp.patch.gz"><CODE>pt0.7.1p1.ptclInvokeInterp.patch.gz</CODE></a>
      Type:
<pre>
 cd $PTOLEMY
 patch -p1 &lt; pt0.7.1p1.ptclInvokeInterp.patch

</pre>
       If the message occurs that hunk#4 failed, then do:
<pre>
cd $PTOLEMY/src/ptcl
make depend
</pre>

<li> To do the actual build, do
<pre>
cd $PTOLEMY
make -k everything &gt;&amp; make.out
</pre>

<li> You can safely ignore the following warnings and errors:
	<menu>
	<li> Ignore the warning:
<pre>
touch: /users/ptolemy/obj.nt4: Permission denied
</pre>


	<li> While building Itcl, you may see warnings like:
<pre>
checking host system type... Invalid configuration
`i586-CYGWIN32-NT40': system `NT40' not recognized

</pre>
	
	<li> Ignore warnings from X11R6 files of the form:
<pre>
type defaults to `int' in declaration
</pre>
	
	<li> <a href="ptntbugs.html#xpackages"><CODE>octtools/Xpackages/iv</CODE> fails to compile</a>
	You can ignore this error.


	<li> <a href="ptntbugs.html#xv">xv fails to build</a>
	In the short term, you can ignore this error.

	</menu>


<li> If you have  problems, try
<a href="ptnthints.html">Ptolemy NT Hints</a> and
<a href="ptntbugs.html">Ptolemy NT Bugs</a>

Also, my
<a href="http://ptolemy.eecs.berkeley.edu/~cxh/nt-ptolemy.html">NT and Ptolemy</a> page might be of use.
</ol>

<HR>
Some of the notes above are from Saschas Schwarz, 
&lt;saschas@natasha.auslabs.lucent.com&gt;.
<HR>
<A HREF="index.html">Up to the Ptolemy under NT page</A> -
<A HREF="ptntbugs.html">Back to Ptolemy NT Bugs</A>
<HR>
Copyright &#169 1997-%Q%, The Regents of the University of California.
All rights reserved.
<br>
Last updated: $Date$,
comments to: <author>cxh@eecs.berkeley.edu</author>

