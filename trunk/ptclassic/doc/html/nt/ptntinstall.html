<!-- $Id$ -->
<html>
<head>
<title>Ptolemy NT Installation</title>
</head>
<body bgcolor=#faf0e6>
<H1>Ptolemy NT Installation</H1>
The Ptolemy NT Installation is more tricky than it should be,
we hope to fix this soon.  

<H2>nt4 Installation Instructions</H2>

<OL>
<LI> Download Cygnus GNU-win32 from
<A HREF="ftp://ftp.cygnus.com/pub/gnu-win32/latest"><CODE>ftp://ftp.cygnus.com/pub/gnu-win32/latest</CODE></A>.
In that directory, download
<A HREF="ftp://ftp.cygnus.com/pub/gnu-win32/latest/README.txt"><CODE>README.txt</CODE></A>
and 
<A HREF="ftp://ftp.cygnus.com/pub/gnu-win32/latest/cdk.exe/"><CODE>cdk.exe</CODE></A>(13.7Mb)

<LI> Install Cygnus GNU-win32 by mousing on the <CODE>cdk.exe</CODE>
icon.  It is best if you install Cygnus GNU-win32 in a directory that
does not have spaces in the pathname.  Usually GNU-win32 is installed
in the top level, so it ends up in <CODE>c:/Cygnus</CODE>.
Be sure to update your path and the other variables mentioned
in the Cygnus <CODE>README.txt</CODE>.


<li> Be sure to do <CODE>mkdir /tmp</CODE>

<li> Part of the GNU-win32 installation includes setting up
<CODE>/bin/sh.exe</CODE> for use from <CODE>make</CODE>:
<pre>
mkdir /bin
cp /Cygnus/B19/H-i386-cygwin32/bin/sh.exe /bin
</pre>
Since the Xgraph stars and various scripts use <CODE>/bin/rm</CODE>
you should also do:
<pre>
cp /Cygnus/B19/H-i386-cygwin32/bin/rm.exe /bin
</pre>

<li> Copy the file gcc.exe from <CODE>Cygnus/B19/H-i386-cygwin-32/bin</CODE>
to <CODE>/bin</CODE> and rename it to <CODE>cc.exe</CODE>. Otherwise
you will get problems while trying to compile xv.

<li> Create <CODE>/etc/passwd</CODE> and <CODE>/etc/group</CODE>
by running 
<pre>
mkdir /etc
mkpasswd -d -l -g > /etc/passwd
mkgroup -d -l > /etc/group
</pre>
For more information, type <CODE>mkpasswd</CODE> and <CODE>mkgroup</CODE>
without any arguments.  The Cygwin faq also covers these programs.
If you do not have <CODE>/etc/passwd</CODE>, then you will get errors
from <CODE>GetTildePath()</CODE> when trying to create an icon.
(Reported by Sascha Schwarz &lt;saschas@natasha.auslabs.lucent.com&gt;)

<li> Install 19.1 from:
<a href="ftp://go.cygnus.com/pub/ftp.cygnus.com/gnu-win32/latest/b19.1-update/"><CODE>ftp://go.cygnus.com/pub/ftp.cygnus.com/gnu-win32/latest/b19.1-update/</CODE></a>.  The installation is fairly straightforward - exit all programs
that use Cygwin32 and substitute in the new <CODE>libcygwinb19.dll</CODE>.

<li> Install egcs-1.0.2 from:
<a href="http://www.xraylith.wisc.edu/~khan/software/gnu-win32/egcs.html"><CODE>http://www.xraylith.wisc.edu/~khan/software/gnu-win32/egcs.html</CODE></a>
This installation involves removing the <CODE>include/g++</CODE> directory
and untarring two tar files.

<li> Download <a href="http://dao.gsfc.nasa.gov/software/grads/win32/X11R6.3">Pre-compiled X11R6.3 Libraries/Clients For GNU Win32 B19 </a>.

<li> Install X11R6.3:
<pre>
mkdir /usr
cd /usr
tar -zxf b19_X11R6_3.tar.gz
mkdir /etc
cp /usr/X11R6.3/etc/termcap /etc
</pre>
<CODE>/etc/termcap</CODE> is necessary for <CODE>xterm</CODE>, which
can be used by <CODE>pigi -debug</CODE>.


<li> Install an X server.  The 
<a href="http://dao.gsfc.nasa.gov/software/grads/win32/X11R6.3">Pre-compiled X11R6.3 Libraries/Clients For GNU Win32 B19 </a> page
has some pointers to freely available X servers.  Locally we use
<a href="http://www.hummingbird.com">Hummingbird's</a> Exceed, which
is a commercial X server package.

<li> Add <CODE>c:\usr\X11R6.3\bin</CODE> to your path by using the
<CODE>System</CODE> control panel.

<li> Verify that the X installation is working by starting up an X server
setting your DISPLAY:
<pre>
DISPLAY=localhost:0.0
</pre>
and then running <CODE>/usr/X11R6.3/bin/xclock</CODE>.
<li> To use the Java version of <a name="pxgraph"><CODE>pxgraph</CODE></a>,
download
<a href="http://www.javasoft.com/products/jdk/1.1/index.html">JDK1.1</a>.
The JDK should be installed in <CODE>c:/jdk1.1.<I>n</I></CODE>
and you will need to update your path.  

 <br>For a prebuilt X11 pxgraph binary, see:
<a href="ftp://ptolemy.eecs.berkeley.edu/pub/misc/pxgraph/index.html"><CODE>ftp://ptolemy.eecs.berkeley.edu/pub/misc/pxgraph/index.html</CODE></a>


</ol>

<h3>Building Ptolemy</h3>

<ol>

<li> Since Ptolemy has lots of small files, you are better off 
avoid FAT partitions and placing the sources on a NTFS partition.

<LI> If you have not yet done so, download the Ptolemy <CODE>src</CODE>
tar file from
<a href="http://ptolemy.eecs.berkeley.edu/pt0.7.1/download.html"><CODE>http://ptolemy.eecs.berkeley.edu/pt0.7.1/download.html</CODE></a>
 and ungzip and untar the files
<PRE>
tar -ztvf pt0.7.1.src.tar.gz
tar -ztvf pt0.7.1.other.src.tar.gz
</PRE>
If you get a warning like <CODE>tar: Error exit delayed from previous errors</CODE>, you can ignore it.  The warning probably comes from files that 
are included twice in the tar file because of symbolic links.
 <br>(Note that there seems to be 
<a href="ptntbugs.html#tar">problem with <CODE>$PTOLEMY/colors/ptolemy/con</CODE></a>, so you may want to use Winzip instead of GNU tar here).


<li> Building Itcl, Octtools and Ptolemy will require about 400Mb of
space for the sources, build directories and installation directories.
To save space, you can build and install Itcl and Octtools separately
and then do

<pre>
rm -rf $PTOLEMY/obj.nt4/tcltk $PTOLEMY/obj.nt4/octtools
</pre>


<li> Set up your environment by setting the variables below.  In the
<CODE>Start</CODE> menu, select <CODE>Settings</CODE>, then
<CODE>Control Panels</CODE>, then <CODE>System</CODE>, then select the
<CODE>Environment</CODE> tab

 <br> The values of <CODE>PTOLEMY</CODE> and <CODE>PTARCH</CODE> should
follow these conventions:
	<menu>
	<li> The value should not contain a colon '<CODE>:</CODE>'.
	 <brp>For example, <CODE>D:/users/ptolemy</CODE> is incorrect.
	<li> Do not use multiple slashes.  
	 <br>For example, <CODE>//D/users/ptolemy</CODE> is incorrect.
	</menu>
The values to set are:
<pre>
PTARCH nt4
PTOLEMY /users/ptolemy
CC gcc
</pre>
Set your <CODE>PATH</CODE> to include
<pre>
%PTOLEMY%/bin:%PTOLEMY%/bin.nt4
</pre>


<li> If you have <a href="http://samba.anu.edu.au/samba/">Samba</a>
setup, then start up <CODE>bash</CODE> and cd to the tree with something like: 

<pre>
mkdir /users/ptolemy
mount //<I>UnixHost</I>/ptolemy /users/ptolemy
cd $PTOLEMY
</pre>

<p>Now you have three ways to get to the sources using Samba:
<ol>

<li> Mount a Ptolemy tree located on Unix machine with the
<CODE>Run</CODE> Start menu choice.

<li> <CODE>cd</CODE> to the UNC, such as <CODE>cd //carson/ptdesign</CODE>

<li> <CODE>cd</CODE> to the Cygwin mount point: <CODE>cd /users/ptolemy</CODE>
</ol>
Note that there are two ways to run Tycho, via the native Windows 
<CODE>itkwish</CODE> or via the Cygwin32 <CODE>itkwish</CODE>.  The
Windows <CODE>itkwish</CODE> does not understand Cygwin32 mount points, but
the Cygwin32 version does.

 <p>Note that you can set PTOLEMY to the raw UNC format 
<CODE>//<I>UnixHost</I>/ptolemy</CODE>, but if you do, you will
have problems with configuring Itcl. Instead use the <CODE>mount</CODE>
command as above.

<li> To build Octtools, you will need to unset the <CODE>LIB</CODE>
environment variable:
<pre>
unset LIB
</pre>

<li> In the System control panel, set the <CODE>CC</CODE>
environment variable to <CODE>gcc</CODE>.  If you don't then
you will get errors while configuring Itcl.


<li> Edit the file <CODE>$PTOLEMY/tycho/util/tydoc/tydoc.tcl</CODE>,
inserting in line 92 the following:
<pre>
 set retval ""
</pre>
so that it will look like this:
<pre>
    set generateIndex 1
    set errorInfo ""
    set retval ""
    if [catch {set retval [::tycho::HTMLDocSys::generateHTML $verbose $debug \
</pre>


<li>  Download and ungzip
<a href="http://ptolemy.eecs.berkeley.edu/pt0.7.1/ptolemy0.7.1/html/reimer0898/pt0.7.1p1.ptclInvokeInterp.patch.gz"><CODE>pt0.7.1p1.ptclInvokeInterp.patch.gz</CODE></a>
      Type:
<pre>
 cd $PTOLEMY
 patch -p1 &lt; pt0.7.1p1.ptclInvokeInterp.patch

</pre>
       If the message occurs that hunk#4 failed, then do:
<pre>
cd $PTOLEMY/src/ptcl
make depend
</pre>

<li> To do the actual build, do
<pre>
cd $PTOLEMY
make -k everything &gt;&amp; make.out
</pre>

<li> You can safely ignore the following warnings and errors:
	<menu>
	<li> While building Itcl, you may see warnings like:
<pre>
checking host system type... Invalid configuration
`i586-CYGWIN32-NT40': system `NT40' not recognized

</pre>
	
	<li> Ignore warnings from X11R6 files of the form:
<pre>
type defaults to `int' in declaration
</pre>
	
	<li> Ignore the warning:
<pre>
touch: /users/ptolemy/obj.nt4: Permission denied
</pre>

	</menu>


<li> If you have  problems, try
<a href="ptnthints.html">Ptolemy NT Hints</a> and
<a href="ptntbugs.html">Ptolemy NT Bugs</a>

Also, my
<a href="http://ptolemy.eecs.berkeley.edu/~cxh/nt-ptolemy.html">NT and Ptolemy</a> page might be of use.
</ol>

<HR>
Some of the notes above are from Saschas Schwarz, 
&lt;saschas@natasha.auslabs.lucent.com&gt;.
<HR>
<A HREF="index.html">Up to the Ptolemy under NT page</A> -
<A HREF="ptntbugs.html">Back to Ptolemy NT Bugs</A>
<HR>
Copyright &#169 1997-%Q%, The Regents of the University of California.
All rights reserved.
<br>
Last updated: $Date$,
comments to: <author>cxh@eecs.berkeley.edu</author>

