# Test suite for RevControl
#
# @Author: Christopher Hylands
#
# @Version: $Id$
#
# @Copyright (c) 1996 The Regents of the University of California.
# All rights reserved.
# 
# Permission is hereby granted, without written agreement and without
# license or royalty fees, to use, copy, modify, and distribute this
# software and its documentation for any purpose, provided that the
# above copyright notice and the following two paragraphs appear in all
# copies of this software.
# 
# IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY
# FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
# ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
# THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
# 
# THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES,
# INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
# PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
# CALIFORNIA HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES,
# ENHANCEMENTS, OR MODIFICATIONS.
# 
# 						PT_COPYRIGHT_VERSION_2
# 						COPYRIGHTENDKEY
#######################################################################

if {[string compare test [info procs test]] == 1} then { 
    source testDefs.tcl
} {}

set TestSuite 1


proc testRevControl {versionControlSystem} {
    if { "$versionControlSystem" == "SCCS" } {
	set testdir sccstst
	set testfile [file join $testdir sccs.itcl]
    } else {
	set testdir rcstst
	set testfile [file join $testdir rcs.itcl]
    }
    # FIXME: Unixism
    exec rm -rf $testdir
    exec mkdir $testdir
    set fd [open $testfile w]
    puts $fd "# This is a test file for the Tycho $versionControlSystem system"
    # Generate percentWpercent so that SCCS does not munge this for us
    # when we check in the file.
    puts $fd [format "# Version: %sW%s %sG%s" % % % %]
    puts $fd [format "# Copyright: %sQ%s" % %]

    close $fd

    set wname [::tycho::autoName .view]
    ::tycho::Displayer $wname
    set myEdit [::tycho::Edit $wname.v -file $testfile]
    $wname centerOnScreen
    set myRevControl [::tycho::RevControl::setup $wname $myEdit]
    ::tycho::safeUpdate $wname

    if {"$versionControlSystem" == "SCCS" } {
	# Press the Yes(SCCS) button
	$myRevControl invoke 0
    } else {
	# Press the Yes(RCS) button
	$myRevControl invoke 1
    }

    # Press the 'Checkout' button
    $wname.revcontrol invoke 1
    ::tycho::safeUpdate $wname.revcontrol

    # Press the 'Checkin' button
    $wname.revcontrol invoke 0
    ::tycho::safeUpdate $wname.revcontrol

    # Press the 'Checkout' button
    $wname.revcontrol invoke 1
    ::tycho::safeUpdate $wname.revcontrol

    # Press the 'History' button
    $wname.revcontrol invoke 2
    ::tycho::safeUpdate $wname.revcontrol

    # Press the 'unedit' button
    $wname.revcontrol invoke 3
    ::tycho::safeUpdate $wname.revcontrol

    # Press the 'esc' button
    $wname.revcontrol invoke 4
}

test SCCS-1.1 {test out sccs} {
    testRevControl SCCS
} {}

test RCS-1.1 {test out sccs} {
    testRevControl RCS
} {}

#doneTests
